---
import { Icon } from "astro-icon/components";
import Sign from "../../assets/images/sign.svg?raw";
import { licenseConfig, profileConfig } from "../../config";
import I18nKey from "../../i18n/i18nKey";
import { i18n } from "../../i18n/translation";
import { formatDateToYYYYMMDDhhmmss } from "../../utils/date-utils";

interface Props {
    title: string;
    slug: string;
    pubDate: Date;
    class: string;
}

const { title, pubDate } = Astro.props;
const className = Astro.props.class;
const profileConf = profileConfig;
const licenseConf = licenseConfig;
const postUrl = decodeURIComponent(Astro.url.toString());
---

<div
    class={`relative transition overflow-hidden bg-[var(--license-block-bg)] py-5 px-6 ${className}`}
>
    <div class="transition font-bold text-black/75 dark:text-white/75">
        {title}
    </div>
    <a href={postUrl} class="link text-[var(--primary)]">
        {postUrl}
    </a>
    <div class="flex gap-6 mt-2">
        <div>
            <div class="transition text-black/30 dark:text-white/30 text-sm">
                {i18n(I18nKey.author)}
            </div>
            <div
                class="transition text-black/75 dark:text-white/75 line-clamp-2"
            >
                {profileConf.name}
            </div>
        </div>
        <div>
            <div class="transition text-black/30 dark:text-white/30 text-sm">
                {i18n(I18nKey.publishedAt)}
            </div>
            <div
                class="transition text-black/75 dark:text-white/75 line-clamp-2"
            >
                {formatDateToYYYYMMDDhhmmss(pubDate)}
            </div>
        </div>
        <div>
            <div class="transition text-black/30 dark:text-white/30 text-sm">
                {i18n(I18nKey.license)}
            </div>
            <a
                href={licenseConf.url}
                target="_blank"
                class="link text-[var(--primary)] line-clamp-2"
                >{licenseConf.name}</a
            >
        </div>
    </div>
    <!-- 这段为签名动画（始终固定在版权栏右下，覆盖在 CC 图标上） -->
    <div
        class="animated-signature transition text-black/75 dark:text-white/75 absolute right-6 bottom-3 pointer-events-none"
    >
        <Fragment set:html={Sign} />
    </div>
    <Icon
        name="fa6-brands:creative-commons"
        class="transition text-[15rem] absolute pointer-events-none right-6 top-1/2 -translate-y-1/2 text-black/5 dark:text-white/5"
    />
</div>

<style is:global>
    /* 使通过 innerHTML 注入的 SVG 能被样式匹配（Astro 的 scoped 样式不会自动作用到 innerHTML） */
    .animated-signature {
        width: 18.75%; /* 根据需要调整签名大小 */
        height: auto;
        vertical-align: middle;
        overflow: visible;
        color: inherit; /* 允许使用 currentColor 作为路径颜色 */
    }

    .animated-signature svg {
        width: 100%;
        height: auto;
        display: block;
    }

    .animated-signature path {
        stroke-dasharray: 2400;
        stroke-dashoffset: 2400;
        fill: transparent;
        animation: drawSignature 8s linear infinite both;
        stroke-width: 2px;
        stroke: currentColor; /* 使用 currentColor 更易控制颜色 */
    }

    @keyframes drawSignature {
        0% {
            stroke-dashoffset: 2400;
        }
        15% {
            fill: transparent;
        }
        35%,
        75% {
            stroke-dashoffset: 0;
            fill: currentColor;
        }
        90%,
        to {
            stroke-dashoffset: 2400;
            fill: transparent;
        }
    }
</style>
